## 后端脚手架构建





## 前端脚手架构建

### 1.项目初始化

构建前端项目，搭建基于react的ant design pro项目脚手架，注意项目版本依赖问题（如果nodejs版本不兼容则适当调整即可）

```powershell
# 使用 npm 加载脚手架
npm i @ant-design/pro-cli -g
# 创建前端项目
pro create noob-frontend

# 选择umi版本（可以尝试umi4踩新坑,umi3提示选择简单还是全量脚手架），原使用umi3 simple

# 进入指定项目安装项目依赖
cd noob-frontend
tyarn 或者 npm install

# 脚手架初始完成，进入开发状态
npm run start

# 项目启动完成访问http://localhost:8000/,第一次初始化加载会比较慢

```

​	查看package.json文件，对照相应的启动命令看其配置，如果执行`npm run dev`命令本质上执行的是`start：dev`，可以看其指令配置中MOCK=none，由于此时还没有接入后台数据接口，因此需要借助MOCK模拟数据接口实现访问。重启项目`npm run start`访问，然后登录访问主页（start以模拟数据方式运行，dev命令禁用了MOCK调用自己定义的后端）

​	项目构建完成，引入git仓库做版本管理



### 2.项目瘦身

 框架本身生成的东西有很多，但实际上一些小型项目中不需要引用这么复杂的内容，为了优化代码结构，此处通过清理项目一些可能不会用到的东西给项目瘦身

#### （1）国际化移除：/src/locales

​	国际化：集成了多种语言：中文、英文... ，考虑项目主要在国内访问，去除国际化配置；如果要使用国际化，还要去配置不同语言的引用

​	在package.json文件中找到`i18n-remove`，这里提供了移除国际化的脚本（ "i18n-remove": "pro i18n-remove --locale=zh-CN --write",），执行指令（如果指令执行失败，参考[官方解决方案](https://github.com/ant-design/ant-design-pro/issues/10452)）

```shell
pro i18n-remove --locale=zh-CN --write

# 指令执行出错，参考官方解决方案，此处参考引入依赖后再次尝试
yarn add eslint-config-prettier
yarn add eslint-plugin-unicorn

或者执行：yarn add eslint-config-prettier --dev yarn add eslint-plugin-unicorn --dev 

修改：
node_modules/@umijs/lint/dist/config/eslint/index.js
// es2022: true
```

​	奇奇怪怪的问题：在vscode中执行指令报错，但是通过cmd窗口执行指令正常（指令执行完毕移除了一些关联配置）



![image-20240416215904248](http://cos.holic-x.com/full-stack/_post/image-20240416215904248.png)



​	指令执行是为了移除国际化相关配置文件，需要**手动移除locales文件夹**，完成清理后重启项目检查是否正常运行

​	重启项目如果报错则进一步排查（例如移除国际化出现SyntaxError: Export 'SelectLang' is not defined，参考[官方解决方案](https://github.com/ant-design/ant-design-pro/issues/11143)：将src/components/index.js 中的 SelectLang 变量删除）

![image-20240416220911174](http://cos.holic-x.com/full-stack/_post/image-20240416220911174.png)

> 常见问题处理：左侧菜单栏不显示

​	需要修改路由配置，给config/route.ts中配置的路由都加上name属性（随后重启项目尝试访问）

### 3.前端模板优化



了解项目结构和内容，把一些不需要用到的东西清理掉



![image-20240417205740212](http://cos.holic-x.com/full-stack/_post/image-20240417205740212.png)



| 项目结构                                                     | 说明（❌表示可删除）                                          |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| .husky                                                       | 检查提交的代码，是否规范（代码检验的小工具）                 |
| config                                                       | umi配置（包括路由、构建等配置）                              |
| config.ts                                                    | Ant Design Pro核心配置（整个项目所用框架配置）               |
| defaultSetting.ts                                            | Ant Design Pro默认配置                                       |
| opeapi.json                                                  | 示例数据（❌）                                                |
| proxy.ts                                                     | 代理（便于本地开发）                                         |
| router.ts                                                    | 定义网页路由（输入网址跳转页面）                             |
| mock                                                         | 本地模拟数据（❌）                                            |
| public/icons                                                 | icons目录存放页面图标（❌）可以引入自定义图标                 |
| src/.umi                                                     | 框架自动生成的隐藏文件（可不管）                             |
| src/components                                               | 业务通用组件                                                 |
| src/locales                                                  | 国际化资源（❌）搭配去除国际化指令删除                        |
| src/pages                                                    | 业务页面入口和常用模板                                       |
| src/service                                                  | 后台接口服务                                                 |
| access.ts                                                    | 控制页面访问权限                                             |
| app.tsx                                                      | Ant Design Pro框架的主要文件                                 |
| global.less                                                  | 全局样式                                                     |
| global.tsx                                                   | 全局JS                                                       |
| manifest.json                                                | 开发app或者h5网页指定多种不同配置（此处可❌）<br />例如：生成项目名称、项目图标尺寸等（打包的时候用到） |
| requestErrorConfig.js                                        | 控制前端页面发送请求的配置                                   |
| service-worker.js                                            | h5网页离线时优化页面的体验                                   |
| tests                                                        | 测试工具（❌）                                                |
| types                                                        | ❌                                                            |
| .editorconfig<br />.eslintignore<br />.eslintrc.js<br />.prettierignore<br />.prettierrc.js | 保证前端项目代码规范                                         |
| jest.config.ts                                               | 单元测试框架                                                 |
| jsconfig.json                                                | 控制语法                                                     |
| README.md                                                    | 项目默认文档                                                 |



> 图标替换：[iconfont](https://www.iconfont.cn/activity/entries/all?activity_id=1)

public目录：（svg下载）logo.svg替换、（png下载）favicon.ico替换

![image-20240417211725596](http://cos.holic-x.com/full-stack/_post/image-20240417211725596.png)



> 标题替换

​	【ctrl+shift+F】将原有Ant Design Pro相关的内容替换为项目相关





